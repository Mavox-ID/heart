<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>З Днем Народження Наталія!</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: #000;
    overflow: hidden;
    font-family: 'Georgia', serif;
}

canvas {
    display: block;
}

#startHeart {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 110px;
    height: 110px;
    cursor: pointer;
    transition: transform 0.3s ease;
    z-index: 10;
}

#startHeart:hover {
    transform: translate(-50%, -50%) scale(1.12);
}

#startHeart path {
    fill: #ff1744;
}

#instructionText {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -250px);
    color: #fff;
    font-size: 20px;
    text-align: center;
    z-index: 11;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

#arrow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -160px);
    font-size: 50px;
    color: #fff;
    z-index: 11;
    animation: bounce 1.5s ease-in-out infinite;
}

@keyframes bounce {
    0%,100% { transform: translate(-50%, -160px); }
    50% { transform: translate(-50%, -140px); }
}

.hidden {
    display: none;
}

#message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-size: 26px;
    text-align: center;
    opacity: 0;
    text-shadow: 0 0 25px rgba(255,255,255,0.8);
    pointer-events: none;
    z-index: 5;
    max-width: 85%;
    font-weight: bold;
    line-height: 1.3;
}

#finalMessage {
    position: absolute;
    top: 52%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #fff;
    font-size: 24px;
    text-align: center;
    opacity: 0;
    text-shadow: 0 0 20px rgba(255,255,255,0.6);
    pointer-events: none;
    z-index: 5;
    max-width: 80%;
    line-height: 1.35;
}

#last37 {
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, 100px);
    opacity: 0;
    font-size: 32px;
    color: #fff;
    text-align: center;
    font-weight: bold;
    text-shadow: 0 0 25px rgba(255,255,255,0.8);
    z-index: 7;
    transition: all 1.2s ease;
}
</style>
</head>
<body>

<svg id="startHeart" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
    <path d="M50,90 C50,90 10,60 10,35 C10,20 20,10 30,10 C40,10 45,15 50,25 C55,15 60,10 70,10 C80,10 90,20 90,35 C90,60 50,90 50,90 Z"/>
</svg>

<div id="instructionText">Натисни на нього</div>
<div id="arrow">↓</div>

<canvas id="canvas"></canvas>
<div id="message"></div>
<div id="finalMessage"></div>
<div id="last37">Вітаю!</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const startHeart = document.getElementById('startHeart');
const message = document.getElementById('message');
const finalMessage = document.getElementById('finalMessage');
const last37 = document.getElementById('last37');
const instructionText = document.getElementById('instructionText');
const arrow = document.getElementById('arrow');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];
let stage = 0;
let heartSize = 2;
let growthWaves = 0;
const maxHeartSize = 15;

class Particle {
    constructor(x,y,targetX,targetY,color='#ff1744',depth=0,brightness=1) {
        this.x=x; this.y=y;
        this.targetX=targetX; this.targetY=targetY;
        this.color=color;
        this.size=Math.random()*3+2;
        this.vx=0; this.vy=0;
        this.arrived=false;
        this.alpha=1;
        this.depth=depth;
        this.brightness=brightness;
    }

    update() {
        if(!this.arrived) {
            const dx=this.targetX-this.x;
            const dy=this.targetY-this.y;
            const dist=Math.sqrt(dx*dx+dy*dy);
            if(dist<2) {
                this.arrived=true;
                this.x=this.targetX;
                this.y=this.targetY;
            } else {
                this.vx=dx*0.05;
                this.vy=dy*0.05;
                this.x+=this.vx;
                this.y+=this.vy;
            }
        }
    }

    draw() {
        ctx.save();
        ctx.globalAlpha=this.alpha;
        const scale=1+(this.depth*0.002);
        const adjustedSize=this.size*scale;
        const r=parseInt(this.color.slice(1,3),16);
        const g=parseInt(this.color.slice(3,5),16);
        const b=parseInt(this.color.slice(5,7),16);
        const bright=0.6+(this.brightness*0.4);
        ctx.fillStyle=`rgb(${r*bright},${g*bright},${b*bright})`;
        ctx.shadowBlur=10;
        ctx.shadowColor=this.color;
        ctx.beginPath();
        ctx.arc(this.x,this.y,adjustedSize,0,Math.PI*2);
        ctx.fill();
        ctx.restore();
    }
}

function createHeart(centerX,centerY,size) {
    const points=[];
    for(let t=0;t<Math.PI*2;t+=0.03) {
        const x=size*16*Math.pow(Math.sin(t),3);
        const y=-size*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
        const depth=Math.sin(t)*size*2;
        const bright=Math.abs(Math.sin(t));
        points.push({x:centerX+x,y:centerY+y,depth:depth,brightness:bright});
    }
    return points;
}

function createPopper(centerX,centerY) {
    const points=[];
    for(let y=0;y<250;y+=2.5) {
        const w=35+(y*0.25);
        for(let x=-w;x<w;x+=3) {
            const d=Math.sqrt(w*w-x*x);
            points.push({x:centerX+x,y:centerY-100+y,depth:d});
        }
    }
    return points;
}

startHeart.addEventListener('click',()=>{
    startHeart.classList.add('hidden');
    instructionText.classList.add('hidden');
    arrow.classList.add('hidden');
    stage=1;
    startAnimation();
});

function startAnimation() {
    const cx=canvas.width/2;
    const cy=canvas.height/2;

    for(let i=0;i<550;i++) {
        const a=Math.random()*Math.PI*2;
        const dist=750+Math.random()*200;
        const x=cx+Math.cos(a)*dist;
        const y=cy+Math.sin(a)*dist;
        particles.push(new Particle(x,y,x,y));
    }

    const heart=createHeart(cx,cy,heartSize);
    particles.forEach((p,i)=>{
        const pt=heart[i%heart.length];
        p.targetX=pt.x; p.targetY=pt.y;
        p.depth=pt.depth;
        p.brightness=pt.brightness;
    });

    animate();
}

function animate() {
    ctx.fillStyle='rgba(0,0,0,0.12)';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    particles.forEach(p=>{p.update(); p.draw();});
    const allArrived=particles.every(p=>p.arrived);

    if(stage===1 && allArrived) {
        stage=2;
        growHeart();
    }

    if(stage===2 && allArrived && growthWaves>=4) {
        stage=3;
        setTimeout(()=>{
            message.textContent='З Днем Народження Наталія';
            message.style.opacity='1';
            message.style.transition='opacity 1s';
            setTimeout(()=>{
                message.style.opacity='0';
                setTimeout(()=>{
                    stage=4;
                    formPopper();
                },1000);
            },4500);
        },600);
    }

    if(stage===4 && allArrived) {
        stage=5;
        setTimeout(()=>{explodePopper();},900);
    }

    requestAnimationFrame(animate);
}

function growHeart() {
    const cx=canvas.width/2;
    const cy=canvas.height/2;
    const add=()=>{
        growthWaves++;
        heartSize+=2;
        for(let i=0;i<170;i++) {
            const a=Math.random()*Math.PI*2;
            const dist=550+Math.random()*280;
            const x=cx+Math.cos(a)*dist;
            const y=cy+Math.sin(a)*dist;
            particles.push(new Particle(x,y,x,y));
        }
        const heart=createHeart(cx,cy,Math.min(heartSize,maxHeartSize));
        particles.forEach((p,i)=>{
            p.arrived=false;
            const pt=heart[i%heart.length];
            p.targetX=pt.x; p.targetY=pt.y;
            p.depth=pt.depth; p.brightness=pt.brightness;
        });
        if(growthWaves<4) setTimeout(add,1000);
    };
    setTimeout(add,700);
}

function formPopper() {
    const cx=canvas.width/2;
    const cy=canvas.height/2;
    const points=createPopper(cx,cy);
    const colors=['#ff6b9d','#c44569','#ffa502','#ff6348','#a29bfe','#fd79a8','#fdcb6e','#e17055'];
    particles.forEach((p,i)=>{
        p.arrived=false;
        const pt=points[i%points.length];
        p.targetX=pt.x; p.targetY=pt.y;
        p.depth=pt.depth||0;
        const idx=Math.floor((i/points.length)*colors.length + (pt.depth||0)*0.1)%colors.length;
        const clr=colors[idx];
        let step=0;
        const total=70;
        const t=setInterval(()=>{
            step++;
            p.color=clr;
            p.brightness=0.7+((pt.depth||0)/100)*0.3;
            if(step>=total) clearInterval(t);
        },35);
    });
}

function explodePopper() {
    particles.forEach(p=>{
        const a=Math.random()*Math.PI*2;
        const s=Math.random()*14+5;
        p.vx=Math.cos(a)*s;
        p.vy=Math.sin(a)*s - Math.random()*8;
        p.arrived=true;
    });

    let t=0;
    const ex=setInterval(()=>{
        t++;
        particles.forEach(p=>{
            p.x+=p.vx;
            p.y+=p.vy;
            p.vy+=0.25;
            p.alpha-=0.012;
        });
        if(t>110) {
            clearInterval(ex);
            stage=6;
            particles=[];
            setTimeout(()=>{
                finalMessage.textContent='Любимо тебе всією родиною. Дякуємо, що ти з нами';
                finalMessage.style.opacity='1';
                finalMessage.style.transition='opacity 1.8s';
                setTimeout(show37,2600);
            },700);
        }
    },30);
}

function show37() {
    finalMessage.style.transform='translate(-50%,-120%)';
    finalMessage.style.opacity='0';

    setTimeout(()=>{
        last37.style.opacity='1';
        last37.style.transform='translate(-50%, -20px)';
    },300);
}

window.addEventListener('resize',()=>{
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
});
</script>

</body>
</html>
